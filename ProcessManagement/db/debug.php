<?php

/*
 * S-BPM Groupware v0.8
 *
 * http://www.tk.informatik.tu-darmstadt.de/
 *
 * Copyright 2012 Thorsten Jacobi, Telecooperation Group @ TU Darmstadt
 * Contact: Stephan.Borgert@cs.tu-darmstadt.de
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 */

include("include/dbconnect.php");

$query = "";
$return = array();

$action = $_REQUEST['action'];

switch ($action){
	case "process":		
		
		$process = $_REQUEST['process'];
			
			mysql_query("TRUNCATE TABLE groups"); 
			mysql_query("TRUNCATE TABLE users"); 
			mysql_query("TRUNCATE TABLE users_x_groups"); 
			mysql_query("TRUNCATE TABLE process;"); 
			mysql_query("TRUNCATE TABLE process_graphs;"); 
			mysql_query("TRUNCATE TABLE process_instance");
			mysql_query("TRUNCATE TABLE relation;"); 
			mysql_query("TRUNCATE TABLE messages;"); 			
			
			mysql_query("INSERT INTO `users` (`ID`, `name`, `active`, `inputpoolsize`) VALUES
						(1, 'Admin', 1, 0),
						(2, 'Philip', 1, 8),
						(3, 'Jens', 1, 8),
						(4, 'Andre', 1, 8)"); 
				
			mysql_query("INSERT INTO `groups` (`ID`, `name`, `active`) VALUES
							(1, 'Employee', 1),
							(2, 'Manager', 1),
							(3, 'Human Resource', 1);"); 
							
			mysql_query("INSERT INTO `users_x_groups` (`userID`, `groupID`, `active`) VALUES
							(2, 2, 1),
							(3, 1, 1),
							(4, 3, 1);"); 
							
			mysql_query("INSERT INTO `process` (`ID`, `name`, `startSubjects`, `graphID`) VALUES
							(1, 'Travel Request', \"[{'ID':'1','name':'Employee','active':'1'},{'ID':'2','name':'Manager','active':'1'},{'ID':'3','name':'Human Resource','active':'1'}]\", 1);");  
							
			mysql_query("INSERT INTO `process_graphs` (`ID`, `graph`) VALUES
							(1, 0x5b7b226964223a22456d706c6f796565222c226e616d65223a224170706c6963616e74222c2274797065223a2273696e676c65222c226465616374697661746564223a66616c73652c226e6f646573223a5b7b226964223a226e30222c2274657874223a225374617274222c227374617274223a747275652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73657d2c7b226964223a226e31222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73657d2c7b226964223a226e32222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2272656365697665222c226465616374697661746564223a66616c73657d2c7b226964223a226e33222c2274657874223a22456e642070726f63657373222c227374617274223a66616c73652c22656e64223a747275652c2274797065223a22656e64222c226465616374697661746564223a66616c73657d2c7b226964223a226e34222c2274657874223a2244656369646520746f20726566696c65222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73657d5d2c226564676573223a5b7b227374617274223a226e30222c22656e64223a226e31222c2274657874223a2250726570617265206170706c69636174696f6e222c22746172676574223a22222c226465616374697661746564223a66616c73657d2c7b227374617274223a226e31222c22656e64223a226e32222c2274657874223a2254726176656c204170706c69636174696f6e222c22746172676574223a224d616e61676572222c226465616374697661746564223a66616c73657d2c7b227374617274223a226e32222c22656e64223a226e33222c2274657874223a225065726d697373696f6e206772616e746564222c22746172676574223a224d616e61676572222c226465616374697661746564223a66616c73657d2c7b227374617274223a226e32222c22656e64223a226e34222c2274657874223a225065726d697373696f6e2064656e696564222c22746172676574223a224d616e61676572222c226465616374697661746564223a66616c73657d2c7b227374617274223a226e34222c22656e64223a226e30222c2274657874223a22526566696c65222c22746172676574223a22222c226465616374697661746564223a66616c73657d2c7b227374617274223a226e34222c22656e64223a226e33222c2274657874223a224e6f20726566696c65222c22746172676574223a22222c226465616374697661746564223a66616c73657d5d2c226e6f6465436f756e746572223a357d2c7b226964223a224d616e61676572222c226e616d65223a22417070726f766572222c2274797065223a2273696e676c65222c226465616374697661746564223a66616c73652c226e6f646573223a5b7b226964223a226e30222c2274657874223a22222c227374617274223a747275652c22656e64223a66616c73652c2274797065223a2272656365697665222c226465616374697661746564223a66616c73657d2c7b226964223a226e31222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73657d2c7b226964223a226e32222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2272656365697665222c226465616374697661746564223a66616c73657d2c7b226964223a226e33222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73657d2c7b226964223a226e34222c2274657874223a22456e642070726f63657373222c227374617274223a66616c73652c22656e64223a747275652c2274797065223a22656e64222c226465616374697661746564223a66616c73657d5d2c226564676573223a5b7b227374617274223a226e30222c22656e64223a226e31222c2274657874223a2254726176656c204170706c69636174696f6e222c22746172676574223a22456d706c6f796565222c226465616374697661746564223a66616c73657d2c7b227374617274223a226e31222c22656e64223a226e32222c2274657874223a2254726176656c204170706c69636174696f6e222c22746172676574223a2248756d616e205265736f75726365222c226465616374697661746564223a66616c73657d2c7b227374617274223a226e32222c22656e64223a226e33222c2274657874223a224170706c69636174696f6e2061636b6e6f776c6564676564222c22746172676574223a2248756d616e205265736f75726365222c226465616374697661746564223a66616c73657d2c7b227374617274223a226e33222c22656e64223a226e34222c2274657874223a225065726d697373696f6e206772616e746564222c22746172676574223a22456d706c6f796565222c226465616374697661746564223a66616c73657d2c7b227374617274223a226e31222c22656e64223a226e34222c2274657874223a225065726d697373696f6e2064656e696564222c22746172676574223a22456d706c6f796565222c226465616374697661746564223a66616c73657d5d2c226e6f6465436f756e746572223a367d2c7b226964223a2248756d616e205265736f75726365222c226e616d65223a2241646d696e697374726174696f6e222c2274797065223a2273696e676c65222c226465616374697661746564223a66616c73652c226e6f646573223a5b7b226964223a226e30222c2274657874223a22222c227374617274223a747275652c22656e64223a66616c73652c2274797065223a2272656365697665222c226465616374697661746564223a66616c73657d2c7b226964223a226e31222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73657d2c7b226964223a226e32222c2274657874223a22456e642070726f63657373222c227374617274223a66616c73652c22656e64223a747275652c2274797065223a22656e64222c226465616374697661746564223a66616c73657d5d2c226564676573223a5b7b227374617274223a226e30222c22656e64223a226e31222c2274657874223a2254726176656c204170706c69636174696f6e222c22746172676574223a224d616e61676572222c226465616374697661746564223a66616c73657d2c7b227374617274223a226e31222c22656e64223a226e32222c2274657874223a2241636b6e6f776c65646765206170706c69636174696f6e222c22746172676574223a224d616e61676572222c226465616374697661746564223a66616c73657d5d2c226e6f6465436f756e746572223a337d5d);"); 
							    
			mysql_query("INSERT INTO `relation` (`userID`, `groupID`, `responsibleID`, `processID`) VALUES
							(0, 1, 3, 0),
							(0, 2, 2, 0),
							(0, 3, 4, 0);"); 


			
		
		break;
	case "user":
		mysql_query("TRUNCATE TABLE groups"); 
		mysql_query("TRUNCATE TABLE users"); 
		mysql_query("TRUNCATE TABLE users_x_groups"); 
		mysql_query("INSERT INTO `users` (`ID`, `name`) VALUES
						(1, 'Admin'),
						(2, 'jhartwig'),
						(3, 'mschrammek'),
						(4, 'aroeder'),
						(5, 'sborgert'),
						(6, 'pbeyer')"); 
		break;
		
	case "clear":	
	
			mysql_query("TRUNCATE TABLE groups"); 
			mysql_query("TRUNCATE TABLE users"); 
			mysql_query("TRUNCATE TABLE users_x_groups"); 
			mysql_query("TRUNCATE TABLE process;"); 
			mysql_query("TRUNCATE TABLE process_graphs;"); 
			mysql_query("TRUNCATE TABLE process_instance");
			mysql_query("TRUNCATE TABLE relation;"); 
			mysql_query("TRUNCATE TABLE messages;"); 	
			
		break;
		
	case "rebuild":	
	
			mysql_query("DROP TABLE groups"); 
			mysql_query("DROP TABLE users"); 
			mysql_query("DROP TABLE users_x_groups"); 
			mysql_query("DROP TABLE process;"); 
			mysql_query("DROP TABLE process_graphs;"); 
			mysql_query("DROP TABLE process_instance");
			mysql_query("DROP TABLE relation;"); 
			mysql_query("DROP TABLE messages;"); 	
			
		break;
}

$rows = mysql_affected_rows($link);

$return['error'] = mysql_error($link);

$return['code'] = ($rows < 1 && !empty($return['error'])) ? 'error' : 'ok' ;
		
echo json_encode($return);
	
?>