<?php

/*
 * S-BPM Groupware v0.8
 *
 * http://www.tk.informatik.tu-darmstadt.de/
 *
 * Copyright 2012 Thorsten Jacobi, Telecooperation Group @ TU Darmstadt
 * Contact: Stephan.Borgert@cs.tu-darmstadt.de
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 */

include("include/dbconnect.php");

$query = "";
$return = array();

$action = $_REQUEST['action'];

switch ($action){
	case "process":		
		
		$process = $_REQUEST['process'];
			
			mysql_query("TRUNCATE TABLE groups"); 
			mysql_query("TRUNCATE TABLE users"); 
			mysql_query("TRUNCATE TABLE users_x_groups"); 
			mysql_query("TRUNCATE TABLE process;"); 
			mysql_query("TRUNCATE TABLE process_graphs;"); 
			mysql_query("TRUNCATE TABLE process_instance");
			mysql_query("TRUNCATE TABLE relation;"); 
			mysql_query("TRUNCATE TABLE messages;"); 			
			
			mysql_query("INSERT INTO `users` (`ID`, `name`, `active`, `inputpoolsize`) VALUES
						(1, 'Admin', 1, 0),
						(2, 'Philip', 1, 8),
						(3, 'Jens', 1, 8),
						(4, 'Andre', 1, 8)"); 
				
			mysql_query("INSERT INTO `groups` (`ID`, `name`, `active`) VALUES
							(1, 'Employee', 1),
							(2, 'Manager', 1),
							(3, 'Human Resource', 1);"); 
							
			mysql_query("INSERT INTO `users_x_groups` (`userID`, `groupID`, `active`) VALUES
							(2, 2, 1),
							(3, 1, 1),
							(4, 3, 1);"); 
							
			mysql_query("INSERT INTO `process` (`ID`, `name`, `startSubjects`, `graphID`) VALUES
							(1, 'Travel Request', \"[{'ID':'1','name':'Employee','active':'1'},{'ID':'2','name':'Manager','active':'1'},{'ID':'3','name':'Human Resource','active':'1'}]\", 1);");  
							
			mysql_query("INSERT INTO `process_graphs` (`ID`, `graph`, `processID`) VALUES
							(1, 0x7b2270726f63657373223a5b7b226964223a22456d706c6f796565222c226e616d65223a224170706c6963616e74222c2274797065223a2273696e676c65222c226465616374697661746564223a66616c73652c22696e707574506f6f6c223a3130302c2272656c6174656450726f63657373223a6e756c6c2c2272656c617465645375626a656374223a6e756c6c2c226e6f646573223a5b7b226964223a226e30222c2274657874223a22507265706172652054726176656c204170706c69636174696f6e222c227374617274223a747275652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e31222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e32222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2272656365697665222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e33222c2274657874223a22456e642070726f63657373222c227374617274223a66616c73652c22656e64223a747275652c2274797065223a22656e64222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e37222c2274657874223a2244656369646520776865746865722066696c696e6720616761696e222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e38222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e39222c2274657874223a224d616b652074726176656c222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d5d2c226564676573223a5b7b227374617274223a226e30222c22656e64223a226e31222c2274657874223a22446f6e65222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e31222c22656e64223a226e32222c2274657874223a226d30222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a224d616e61676572222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e32222c22656e64223a226e37222c2274657874223a226d31222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a224d616e61676572222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e37222c22656e64223a226e38222c2274657874223a2244656e69616c20616b7a6570746564222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e38222c22656e64223a226e33222c2274657874223a226d32222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a224d616e61676572222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e37222c22656e64223a226e30222c2274657874223a225265646f2054726176656c204170706c69636174696f6e222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e32222c22656e64223a226e39222c2274657874223a226d33222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a224d616e61676572222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e39222c22656e64223a226e33222c2274657874223a22222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d5d2c226e6f6465436f756e746572223a31307d2c7b226964223a224d616e61676572222c226e616d65223a2253757065727669736f72222c2274797065223a2273696e676c65222c226465616374697661746564223a66616c73652c22696e707574506f6f6c223a3130302c2272656c6174656450726f63657373223a6e756c6c2c2272656c617465645375626a656374223a6e756c6c2c226e6f646573223a5b7b226964223a226e30222c2274657874223a22222c227374617274223a747275652c22656e64223a66616c73652c2274797065223a2272656365697665222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e31222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e3132222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e3133222c2274657874223a22456e642050726f63657373222c227374617274223a66616c73652c22656e64223a747275652c2274797065223a22656e64222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e3134222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2272656365697665222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e3135222c2274657874223a22436865636b2054726176656c204170706c69636174696f6e222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e3136222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d5d2c226564676573223a5b7b227374617274223a226e31222c22656e64223a226e3132222c2274657874223a226d33222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22456d706c6f796565222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e3132222c22656e64223a226e3133222c2274657874223a226d34222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a2248756d616e205265736f75726365222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e3134222c22656e64223a226e3133222c2274657874223a226d32222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22456d706c6f796565222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e30222c22656e64223a226e3135222c2274657874223a226d30222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22456d706c6f796565222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e3135222c22656e64223a226e31222c2274657874223a224772616e74205065726d697373696f6e222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e3134222c22656e64223a226e3135222c2274657874223a226d30222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22456d706c6f796565222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e3135222c22656e64223a226e3136222c2274657874223a2244656e79205065726d697373696f6e222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e3136222c22656e64223a226e3134222c2274657874223a226d31222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22456d706c6f796565222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d5d2c226e6f6465436f756e746572223a31377d2c7b226964223a2248756d616e205265736f75726365222c226e616d65223a2241646d696e697374726174696f6e222c2274797065223a2273696e676c65222c226465616374697661746564223a66616c73652c22696e707574506f6f6c223a3130302c2272656c6174656450726f63657373223a6e756c6c2c2272656c617465645375626a656374223a6e756c6c2c226e6f646573223a5b7b226964223a226e30222c2274657874223a22222c227374617274223a747275652c22656e64223a66616c73652c2274797065223a2272656365697665222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e31222c2274657874223a2248616e646c652054726176656c204170706c69636174696f6e222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d2c7b226964223a226e32222c2274657874223a22456e642070726f63657373222c227374617274223a66616c73652c22656e64223a747275652c2274797065223a22656e64222c226465616374697661746564223a66616c73652c226f7074696f6e73223a7b226d657373616765223a222a222c227375626a656374223a222a227d7d5d2c226564676573223a5b7b227374617274223a226e30222c22656e64223a226e31222c2274657874223a226d34222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a224d616e61676572222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d2c7b227374617274223a226e31222c22656e64223a226e32222c2274657874223a2254726176656c204170706c69636174696f6e2066696c6564222c2274797065223a2265786974636f6e646974696f6e222c22746172676574223a22222c226465616374697661746564223a66616c73652c226f7074696f6e616c223a66616c73652c227072696f72697479223a317d5d2c226e6f6465436f756e746572223a337d5d2c226d65737361676573223a7b226d30223a2254726176656c204170706c69636174696f6e222c226d31223a225065726d697373696f6e2064656e696564222c226d32223a224e6f20667572746865723c6272202f3e54726176656c204170706c69636174696f6e222c226d33223a225065726d697373696f6e206772616e746564222c226d34223a22417070726f7665643c6272202f3e54726176656c204170706c69636174696f6e227d2c226d657373616765436f756e746572223a357d, 1);"); 
							    
			mysql_query("INSERT INTO `relation` (`userID`, `groupID`, `responsibleID`, `processID`) VALUES
							(0, 1, 3, 0),
							(0, 2, 2, 0),
							(0, 3, 4, 0);"); 


			
		
		break;
	case "user":
		mysql_query("TRUNCATE TABLE groups"); 
		mysql_query("TRUNCATE TABLE users"); 
		mysql_query("TRUNCATE TABLE users_x_groups"); 
		mysql_query("INSERT INTO `users` (`ID`, `name`) VALUES
						(1, 'Admin'),
						(2, 'jhartwig'),
						(3, 'mschrammek'),
						(4, 'aroeder'),
						(5, 'sborgert'),
						(6, 'pbeyer')"); 
		break;
		
	case "clear":	
	
			mysql_query("TRUNCATE TABLE groups"); 
			mysql_query("TRUNCATE TABLE users"); 
			mysql_query("TRUNCATE TABLE users_x_groups"); 
			mysql_query("TRUNCATE TABLE process;"); 
			mysql_query("TRUNCATE TABLE process_graphs;"); 
			mysql_query("TRUNCATE TABLE process_instance");
			mysql_query("TRUNCATE TABLE relation;"); 
			mysql_query("TRUNCATE TABLE messages;"); 	
			
		break;
		
	case "rebuild":	
	
			mysql_query("DROP TABLE groups"); 
			mysql_query("DROP TABLE users"); 
			mysql_query("DROP TABLE users_x_groups"); 
			mysql_query("DROP TABLE process;"); 
			mysql_query("DROP TABLE process_graphs;"); 
			mysql_query("DROP TABLE process_instance");
			mysql_query("DROP TABLE relation;"); 
			mysql_query("DROP TABLE messages;"); 	
			
		break;
}

$rows = mysql_affected_rows($link);

$return['error'] = mysql_error($link);

$return['code'] = ($rows < 1 && !empty($return['error'])) ? 'error' : 'ok' ;
		
echo json_encode($return);
	
?>