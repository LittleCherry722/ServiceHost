<?php

/*
 * S-BPM Groupware v0.8
 *
 * http://www.tk.informatik.tu-darmstadt.de/
 *
 * Copyright 2012 Thorsten Jacobi, Telecooperation Group @ TU Darmstadt
 * Contact: Stephan.Borgert@cs.tu-darmstadt.de
 *
 * This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this file,
 * You can obtain one at http://mozilla.org/MPL/2.0/.
 */

include("include/dbconnect.php");

$query = "";
$return = array();

$action = $_REQUEST['action'];

switch ($action){
	case "process":		
		
		$process = $_REQUEST['process'];
			
			mysql_query("TRUNCATE TABLE groups"); 
			mysql_query("TRUNCATE TABLE users"); 
			mysql_query("TRUNCATE TABLE users_x_groups"); 
			mysql_query("TRUNCATE TABLE process;"); 
			mysql_query("TRUNCATE TABLE process_gtaphs;"); 
			mysql_query("TRUNCATE TABLE process_instance");
			mysql_query("TRUNCATE TABLE relation;"); 
			mysql_query("TRUNCATE TABLE messages;"); 			
			
			mysql_query("INSERT INTO `users` (`ID`, `name`) VALUES
							(1, 'Admin'),
							(2, 'jhartwig'),
							(3, 'mschrammek'),
							(4, 'aroeder'),
							(5, 'sborgert'),
							(6, 'pbeyer')"); 
				
			mysql_query("INSERT INTO `groups` (`ID`, `name`) VALUES
							(1, 'Manager'),
							(2, 'Employee'),
							(3, 'HR');"); 
							
			mysql_query("INSERT INTO `users_x_groups` (`userID`, `groupID`) VALUES
							(2, 1),
							(3, 1),
							(4, 2),
							(5, 2),
							(6, 3);"); 
							
			mysql_query("INSERT INTO `process` (`ID`, `name`, `startSubjects`, `graphID`) VALUES
							(1, 'Urlaubsantrag', '[\"2\"]', 1);"); 
							
			mysql_query("INSERT INTO `process_graphs` (`ID`, `graph`) VALUES
							(1, 0x5b7b226964223a22656d706c6f796565222c226e616d65223a22456d706c6f796565222c2274797065223a2273696e676c65222c226465616374697661746564223a66616c73652c226e6f646573223a5b7b226964223a227374617274222c2274657874223a2266696c6c206f7574207661636174696f6e2072657175657374222c227374617274223a747275652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73657d2c7b226964223a227331222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73657d2c7b226964223a227231222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2272656365697665222c226465616374697661746564223a66616c73657d2c7b226964223a2261637431222c2274657874223a2274616b653c6272202f3e7661636174696f6e222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73657d2c7b226964223a2261637432222c2274657874223a22636865636b3c6272202f3e64656e69616c3c6272202f3e726561736f6e222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73657d2c7b226964223a2261637433222c2274657874223a2261646170743c6272202f3e7661636174696f6e3c6272202f3e72657175657374222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73657d2c7b226964223a22656e64222c2274657874223a22222c227374617274223a66616c73652c22656e64223a747275652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73657d5d2c226564676573223a5b7b227374617274223a227374617274222c22656e64223a227331222c2274657874223a22222c22746172676574223a22222c226465616374697661746564223a66616c73657d2c7b227374617274223a227331222c22656e64223a227231222c2274657874223a227661636174696f6e3c6272202f3e72657175657374222c22746172676574223a226d616e61676572222c226465616374697661746564223a66616c73657d2c7b227374617274223a227231222c22656e64223a2261637432222c2274657874223a2264656e69616c222c22746172676574223a226d616e61676572222c226465616374697661746564223a66616c73657d2c7b227374617274223a227231222c22656e64223a2261637431222c2274657874223a22617070726f76616c222c22746172676574223a226d616e61676572222c226465616374697661746564223a66616c73657d2c7b227374617274223a2261637431222c22656e64223a22656e64222c2274657874223a22222c22746172676574223a22222c226465616374697661746564223a66616c73657d2c7b227374617274223a2261637432222c22656e64223a2261637433222c2274657874223a22222c22746172676574223a22222c226465616374697661746564223a66616c73657d2c7b227374617274223a2261637432222c22656e64223a22656e64222c2274657874223a226164617074696f6e3c6272202f3e6e6f7420706f737369626c65222c22746172676574223a22222c226465616374697661746564223a66616c73657d2c7b227374617274223a2261637433222c22656e64223a227374617274222c2274657874223a22222c22746172676574223a22222c226465616374697661746564223a66616c73657d5d7d2c7b226964223a226d616e61676572222c226e616d65223a224d616e61676572222c2274797065223a2273696e676c65222c226465616374697661746564223a66616c73652c226e6f646573223a5b7b226964223a2272637631222c2274657874223a22222c227374617274223a747275652c22656e64223a66616c73652c2274797065223a2272656365697665222c226465616374697661746564223a66616c73657d2c7b226964223a2261637431222c2274657874223a227265766965773c6272202f3e7661636174696f6e3c6272202f3e72657175657374222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73657d2c7b226964223a227331222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73657d2c7b226964223a227332222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73657d2c7b226964223a227333222c2274657874223a22222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a2273656e64222c226465616374697661746564223a66616c73657d2c7b226964223a22656e64222c2274657874223a22222c227374617274223a66616c73652c22656e64223a747275652c2274797065223a22656e64222c226465616374697661746564223a66616c73657d5d2c226564676573223a5b7b227374617274223a2272637631222c22656e64223a2261637431222c2274657874223a227661636174696f6e3c6272202f3e72657175657374222c22746172676574223a22656d706c6f796565222c226465616374697661746564223a66616c73657d2c7b227374617274223a2261637431222c22656e64223a227331222c2274657874223a2264656e69616c222c22746172676574223a22222c226465616374697661746564223a66616c73657d2c7b227374617274223a2261637431222c22656e64223a227332222c2274657874223a22617070726f76616c222c22746172676574223a22222c226465616374697661746564223a66616c73657d2c7b227374617274223a227331222c22656e64223a2272637631222c2274657874223a2264656e69616c222c22746172676574223a22656d706c6f796565222c226465616374697661746564223a66616c73657d2c7b227374617274223a227332222c22656e64223a227333222c2274657874223a22617070726f76616c222c22746172676574223a22656d706c6f796565222c226465616374697661746564223a66616c73657d2c7b227374617274223a227333222c22656e64223a22656e64222c2274657874223a22617070726f7665643c6272202f3e7661636174696f6e3c6272202f3e72657175657374222c22746172676574223a226872222c226465616374697661746564223a66616c73657d5d7d2c7b226964223a226872222c226e616d65223a2248756d616e3c6272202f3e5265736f7572636573222c2274797065223a2273696e676c65222c226465616374697661746564223a66616c73652c226e6f646573223a5b7b226964223a2272637631222c2274657874223a22222c227374617274223a747275652c22656e64223a66616c73652c2274797065223a2272656365697665222c226465616374697661746564223a66616c73657d2c7b226964223a2261637431222c2274657874223a22617263686976653c6272202f3e7661636174696f6e2072657175657374222c227374617274223a66616c73652c22656e64223a66616c73652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73657d2c7b226964223a22656e64222c2274657874223a22222c227374617274223a66616c73652c22656e64223a747275652c2274797065223a22616374696f6e222c226465616374697661746564223a66616c73657d5d2c226564676573223a5b7b227374617274223a2272637631222c22656e64223a2261637431222c2274657874223a22222c22746172676574223a22222c226465616374697661746564223a66616c73657d2c7b227374617274223a2261637431222c22656e64223a22656e64222c2274657874223a227661636174696f6e3c6272202f3e726571756573743c6272202f3e6172636869766564222c22746172676574223a22222c226465616374697661746564223a66616c73657d5d7d5d);"); 
							
			mysql_query("INSERT INTO `relation` (`userID`, `groupID`, `responsibleID`, `processID`) VALUES
							(0, 1, 2, 1),
							(0, 2, 4, 1),
							(0, 3, 6, 1);"); 
		
		break;
	case "user":
		mysql_query("TRUNCATE TABLE groups"); 
		mysql_query("TRUNCATE TABLE users"); 
		mysql_query("TRUNCATE TABLE users_x_groups"); 
		mysql_query("INSERT INTO `users` (`ID`, `name`) VALUES
						(1, 'Admin'),
						(2, 'jhartwig'),
						(3, 'mschrammek'),
						(4, 'aroeder'),
						(5, 'sborgert'),
						(6, 'pbeyer')"); 
		break;
		
	case "clear":	
	
			mysql_query("TRUNCATE TABLE groups"); 
			mysql_query("TRUNCATE TABLE users"); 
			mysql_query("TRUNCATE TABLE users_x_groups"); 
			mysql_query("TRUNCATE TABLE process;"); 
			mysql_query("TRUNCATE TABLE process_gtaphs;"); 
			mysql_query("TRUNCATE TABLE process_instance");
			mysql_query("TRUNCATE TABLE relation;"); 
			mysql_query("TRUNCATE TABLE messages;"); 	
			
		break;
		
	case "rebuild":	
	
			mysql_query("DROP TABLE groups"); 
			mysql_query("DROP TABLE users"); 
			mysql_query("DROP TABLE users_x_groups"); 
			mysql_query("DROP TABLE process;"); 
			mysql_query("DROP TABLE process_gtaphs;"); 
			mysql_query("DROP TABLE process_instance");
			mysql_query("DROP TABLE relation;"); 
			mysql_query("DROP TABLE messages;"); 	
			
		break;
}

$rows = mysql_affected_rows($link);

$return['error'] = mysql_error($link);

$return['code'] = ($rows < 1 && !empty($return['error'])) ? 'error' : 'ok' ;
		
echo json_encode($return);
	
?>